@model FarmaciaSantaRita.Models.Proveedor
@{
    ViewData["Title"] = "REGISTRAR PROVEEDOR";
}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
    /* --- ESTILO DE LOS CAMPOS --- */
    .form-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 5px;
        font-size: 15px;
    }

    .form-control {
        border-radius: 8px;
        border: 1px solid #ced4da;
        padding: 8px 12px;
        transition: all 0.2s ease-in-out;
        height: 40px;
    }

        /* --- EFECTO OUTER GLOW (Resplandor rojo) --- */
        .form-control.input-validation-error {
            border-color: #dc3545 !important;
            box-shadow: 0 0 10px rgba(220, 53, 69, 0.5) !important;
        }

    /* --- BOTONES (AZUL UNIFICADO) --- */
    .btn-accion-form {
        background-color: #007bff;
        color: white !important;
        border: none;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 600;
        width: 100%;
        height: 38px;
        line-height: 38px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        transition: all 0.2s ease;
        text-decoration: none !important;
        display: block;
        text-align: center;
        padding: 0;
        cursor: pointer;
    }

        .btn-accion-form:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

    /* --- TÍTULO --- */
    .titulo-registro {
        font-size: 17px;
        font-weight: 600;
        color: #0d6efd;
        text-align: center;
        border-bottom: 2px solid rgba(13, 110, 253, 0.2);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding-bottom: 2px;
        margin-bottom: 20px;
    }

    .swal2-popup {
        border-radius: 15px !important;
    }
</style>

<div class="container mt-5" style="max-width: 650px;">
    <div class="card shadow-lg p-4 border-0" style="border-radius: 15px;">

        <div class="text-center mb-4">
            <img src="~/images/file_0000000079e461fd8636559665695d53.png"
                 alt="Farmacia Santa Rita"
                 style="width: 100%; height: auto; max-height: 150px; object-fit: contain;">
        </div>

        <div class="titulo-registro" translate="no">Registrar Proveedor</div>

        <form asp-action="Registrar" method="post" novalidate id="formRegistrar">

            <div class="row mb-3">
                <div class="col-md-6">
                    <label asp-for="NombreProveedor" class="form-label">Nombre</label>
                    <input asp-for="NombreProveedor" class="form-control" autocomplete="off" placeholder="Nombre de la empresa" />
                </div>
                <div class="col-md-6">
                    <label asp-for="TelefonoProveedor" class="form-label">Teléfono</label>
                    <input asp-for="TelefonoProveedor" class="form-control" autocomplete="off" placeholder="3865XXXXXX" />
                </div>
            </div>

            <div class="mb-3">
                <label asp-for="CorreoProveedor" class="form-label">Correo Electrónico</label>
                <input asp-for="CorreoProveedor" type="email" class="form-control" autocomplete="off" placeholder="proveedor@correo.com" />
            </div>

            <input type="hidden" name="EstadoProveedor" value="Activo" />

            <div class="row mt-4">
                <div class="col-6">
                    <button type="submit" id="btnSubmit" class="btn-accion-form" translate="no">Registrar Proveedor</button>
                </div>
                <div class="col-6">
                    <a asp-action="Index" class="btn-accion-form">Volver</a>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function () {
            var formulario = document.getElementById('formRegistrar');
            var misInputs = document.querySelectorAll('#formRegistrar input:not([type="hidden"])');
            var botonVolver = document.querySelector('a[asp-action="Index"]');

            // 1. Éxito desde el servidor
            @if (TempData["MensajeExito"] != null)
            {
                    <text>
                    Swal.fire({
                        title: '¡Éxito!',
                        text: '@TempData["MensajeExito"]',
                        icon: 'success',
                        confirmButtonColor: '#007bff',
                            confirmButtonText: 'Entendido'
                    });
                    </text>
            }

            // 2. Validación y Envío
            if (formulario) {
                formulario.addEventListener('submit', function (e) {
                    var hayVacios = false;
                    var inputEmail = document.querySelector('input[type="email"]');
                    var valorEmail = inputEmail ? inputEmail.value.trim() : "";

                    // Revisar campos vacíos
                    for (var i = 0; i < misInputs.length; i++) {
                        if (misInputs[i].value.trim() === "") {
                            hayVacios = true;
                            misInputs[i].classList.add('input-validation-error');
                        }
                    }

                    if (hayVacios) {
                        e.preventDefault();
                        Swal.fire({
                            title: '¡Atención!',
                            text: 'Todos los campos son obligatorios.',
                            confirmButtonColor: '#007bff'
                        });
                        return;
                    }

                    // 3. Validación de Correo (Regex con @@ para evitar error de Razor)
                    var patronEmail = /^[a-zA-Z0-9._-]+@@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
                    if (!patronEmail.test(valorEmail)) {
                        e.preventDefault();
                        if (inputEmail) inputEmail.classList.add('input-validation-error');
                        Swal.fire({
                            title: 'Correo Inválido',
                            text: 'Asegúrate de incluir el "@@", un dominio y una extensión válida.',
                            confirmButtonColor: '#007bff'
                        });
                        return;
                    }
                });
            }

            // 4. Limpiar error visual al escribir
            for (var j = 0; j < misInputs.length; j++) {
                misInputs[j].addEventListener('input', function () {
                    this.classList.remove('input-validation-error');
                });
            }

            // 5. Confirmación al Volver
            if (botonVolver) {
                botonVolver.addEventListener('click', function (e) {
                    var tieneContenido = false;
                    for (var k = 0; k < misInputs.length; k++) {
                        if (misInputs[k].value.trim() !== "") tieneContenido = true;
                    }

                    if (tieneContenido) {
                        e.preventDefault();
                        var destino = this.getAttribute('href');
                        Swal.fire({
                            title: '¿Deseas salir?',
                            text: "Tienes cambios sin guardar que se perderán.",
                            showCancelButton: true,
                            confirmButtonColor: '#007bff',
                            cancelButtonColor: '#007bff',
                            confirmButtonText: 'Sí, salir',
                            cancelButtonText: 'Cancelar'
                        }).then(function (result) {
                            if (result.isConfirmed) {
                                window.location.href = destino;
                            }
                        });
                    }
                });
            }
        });
    </script>
}